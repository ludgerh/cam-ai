{% extends 'main/basis.html' %}
{% comment %}
Copyright (C) 2024-2025 by the CAM-AI team, info@cam-ai.de
More information and complete source: https://github.com/ludgerh/cam-ai
This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 3
of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
{% endcomment %}
{% block content %}
{% if emulatestatic %}
  {% load static %}
  <script src="{% static 'camai/git/js/wstools.js' %}"></script>
  <script src="{% static 'camai/nogit/js/jquery-3.5.1.js' %}"></script>
{% else %}
  <script src="https://static.cam-ai.de/{{ version }}/camai/git/js/wstools.js"></script>
  <script src="https://static.cam-ai.de/{{ version }}/camai/nogit/js/jquery-3.5.1.min.js"></script>
{% endif %}
  
<main>
  {% if phase == 0 %}
    <div class="h2">
      Select the backup ZIP file you want to upload to this server.
    </div> 
    <form class="h2" id="upload-form" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input id="fileselector" type="file" name="myfile">
      <button id="upload-btn" type="submit">Upload</button>
    </form>
    <div class="h2 d-none" id="line2">
      Sending the upload. Please wait...
    </div>  
    <div class="h2 d-none" id="line3">?</div>  
  {% endif %}
  {% if phase == 1 %}
    <div class="h2">
      We received the ZIP File. Select what you want to import:<BR>
    </div> 
    <form class="h2" action="{% url 'tools:process_restore' %}" 
        id="import-form" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="job_type" value="restore">
      <input type="checkbox" id="check_files" name="check_files" checked>
      Import files?<BR>
      <input type="checkbox" id="check_db" name="check_db" checked>
      Import database content?<BR><BR>
      Important: Only click import, if you know what you are doing.
      The process will overwrite your CAM-AI servers data!
      <button id="import-btn" type="submit">Import</button>
    </form>
    <div class="h2 d-none" id="line2">
      Processing the upload. Please wait...
    </div>  
  {% endif %}
  
</main>
  
<script>

let tools_asyncSocket;

$(document).ready(function() {
  {% if phase == 0 %}
    $('#upload-form').on('submit', function () {
      $('#line2').removeClass('d-none');
      $('#line3').addClass('d-none');
      $('#upload-btn').prop('disabled', true);
    });
  {% endif %}
  {% if phase == 1 %}
    $('#import-form').on('submit', function () {
      $('#line2').removeClass('d-none');
      $('#line3').addClass('d-none');
      $('#import-btn').prop('disabled', true);
    });
  {% endif %}
});

</script>  

{% endblock %}

